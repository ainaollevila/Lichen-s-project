
\subsection{Empirical Network Analysis.}

We  used the \cite{dalgrande2012verticalandhorizontalphotobionttransmissionwithinpopulationsofalichensymbiosis} dataset to create a bipartite network of the relationships between the symbionts. We took the algae and the fungal lists of microsatellites separately. For each algae An (in symbiosis with a fungus Fn, we looked for the existence of another fungus Fm in symbiosis with a similar algae Am and thus created a link between An and Fm. As a preliminary test to check the validity of our methods, we considered two symbionts as similar when they shared at least six out of seven microsatellites (for the algae) and seven out of eight microsatellites for the fungi. The assumption behind this is that symbionts that are closer genetically have a higher probability to come from the same ancestor (Fig. 2). 


\subsection{ECHO Model.}

We constructed an agent-based model based on the widely used ECHO framework [18, 19]. The ECHO model typically consists of a collection of entities living in a simplified spatial domain, which can move around and interact with one another and with their environment. The interactions among agents can be used to model combat/confrontation, exchanges of goods or even mating in a more biological setting, and are driven by locality (co-localization of the entities) as well as agent-specific properties. These properties, usually called the agent genotype, are codified in the form of a symbol string or tag, and are used to determine the needs of the agents and the probabilities of interaction with the other entities through string matching [18] or, more generally, computing Hamming distances between agent?s genotypes. The ECHO model is also a continuous genetic algorithm  [20]; upon reproduction old genotypes are copied with slight mutations, giving rise to interesting evolutionary dynamics.

 In our case, we codified the different compartments of the L. pulmonaria system as well as the transitions between them (Fig 1). We used the tag system of ECHO to model the molecular recognition (receptors and physical embedding) between algae and fungi necessary to create the lichen. Each genotype consisted of a 11 bit string (thus allowing for $2^11=2048$ possible genotypes). Lichenization probabilities were calculated using the normalized similarity between bit strings (1-Hamming distance (G1,G2)/11). We considered two different lichenization functions, sigmoid (hill function with $n=2$) and michaelis-menten (saturation dynamics typical of enzymatic reactions). Additionally, other ecologically relevant features such as dispersal rates (introduced as random walks) and the ratio between sexual and asexual reproduction were included in the model. 
 
Simulations were initialized with a random uniform distribution of genotypes for both partners (algae and fungi) as well as randomized positions for the agents. After a fixed amount of iterations of the algorithm, snapshots of genotype composition of the population were taken (Fig. 4) and stored as a bipartite network. In particular, trying to reproduce the kind of information available from Dal Grande et al. (2012) we collected the genotypes of all the agents conforming a lichen for a given amount of algorithm iterations. Additionally, different kinds of ecological relations between algae and fungi were simulated: competition (both algae and fungi are better off on their own than forming a lichen), parasitism (only one type of agent benefits from the partnership) and mutualism (both agents benefit).

\textbf{Model Network Analysis.} 
For the bipartite networks retrieved from the ECHO model, we unraveled the modular structure of the lichen population to reveal the coevolution of the symbionts. We analyzed nestedness and modularity of the bipartite networks retrieved from the ECHO model and compared it to various null models via the BiMAT package in MATLAB [21]. For ecological networks (dealing with species? interactions), nestedness occurs when specialist species tend to interact with subsets of species that interact with more generalist species [22]. Although there is relative consensus on the meaning of nestedness, there are several distinct metrics by which it can be measured. The biMAT package implements the widely used NODF measure (0<=NODF<=1) of nestedness [23]. The modularity measure (0<=Qb<=1) we used detects communities including both types of nodes [24], as opposed to the measure where communities are formed by nodes of the same type [25]. 


